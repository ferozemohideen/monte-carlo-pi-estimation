<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>monte_carlo_simulation</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    <link rel="stylesheet" href="assets/css/Article-Clean.css">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body style="background-color: rgb(254,249,239);">
    <div class="article-clean" style="background-color: rgb(254,249,239);">
        <div class="container">
            <div class="row">
                <div class="col-lg-10 col-xl-8 offset-lg-1 offset-xl-2">
                    <div class="intro">
                        <h1 class="text-center" style="font-family: Roboto, sans-serif;"><strong>Monte Carlo
                                Simulations</strong></h1>
                        <p class="text-center" style="font-family: Roboto, sans-serif;"><span class="by">by</span> <a
                                href="#">Feroze</a><span class="date">July 12th, 2019</span></p>
                    </div>
                    <div class="text">
                        <p style="font-family: Roboto, sans-serif;">The concept of the Monte Carlo simulation originated
                            from Polish-American mathematician <a
                                href="https://en.wikipedia.org/wiki/Stanislaw_Ulam">Stanislaw Ulam</a>, who, apart from
                            his love of thermonuclear weapons, was a big fan
                            of solitaire. He spent a lot of time playing the game while recovering from an illness, and
                            sought a way to predict his chance of winning using combinatorics. Despite being an
                            incredible mathematician, he failed to do so.&nbsp;</p>
                        <p style="font-family: Roboto, sans-serif;">Ulam then supposed that instead of calculating a
                            probability, he would just try playing a few hands, count the number of hands he won, then
                            divide by the number of games played. He realized, however, that it might take him a very
                            long time to win even a single game, so he turned to his friend <a
                                href="https://en.wikipedia.org/wiki/John_von_Neumann">John von Neumann</a>&nbsp;to help
                            him <em>simulate </em>them instead. von Neumann used his new <a
                                href="https://en.wikipedia.org/wiki/ENIAC">ENIAC</a>&nbsp;to
                            simulate multiple games of solitaire within a few hours of computation, a task that would
                            take microseconds today.</p>
                        <p style="font-family: Roboto, sans-serif;">Formally, the Monte Carlo simulation is a method of
                            estimating the value of an unknown quantity using the principles of inferential statistics.
                            It involves making predictions about a <em>population</em>, or a set of examples,
                            using information about a <em>sample, </em>or a proper subset of the population. In the
                            solitaire example, the population is the set of all possible games of solitaire - a very
                            large set - and the sample is the set of simulated
                            games done by the computer. The key fact that Monte Carlo simulations rely upon is that if
                            one chooses a sample at random, it tends to exhibit the same properties as the population
                            from which it is drawn.</p>
                        <p style="font-family: Roboto, sans-serif;">There are many applications to the Monte Carlo
                            simulation, belonging to fields like <a
                                href="https://en.wikipedia.org/wiki/Bayesian_inference_in_phylogeny">computational
                                biology</a>, <a href="https://en.wikipedia.org/wiki/Direct_simulation_Monte_Carlo">fluid
                                dynamics</a>,
                            and even <a href="https://en.wikipedia.org/wiki/Path_tracing">computer
                                graphics</a>.&nbsp;The following section visualizes an example of using a simulation to
                            estimate the value of pi.</p>
                        <h2 style="font-family: Roboto, sans-serif;">Estimation of Pi using a Monte Carlo Simulation
                        </h2>
                        <p style="font-family: Roboto, sans-serif;">One can estimate pi using something as simple as a
                            dartboard; shoot darts at a square board, and the number of darts that land within 1 unit
                            from the origin (or in a circle of radius 1 unit) divided by the number of darts outside
                            the circle is a simple estimate of the ratio between the area of the circle and that of the
                            square: pi. Theoretically, with infinite darts, one could determine the exact value of pi.
                            The interactive example below simulates
                            the throwing of many darts and the resulting estimate of pi.</p>
                    </div>
                    <div id="chart" class="text">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <script>
        d3.select("div#chart")
            .append("div")
            // Container class to make it responsive.
            .classed("svg-container", true)
            .append("svg")
            // Responsive SVG needs these 2 attributes and no width and height attr.
            //.attr("preserveAspectRatio", "xMinYMin meet")
            .attr("width", "400")
            .attr("height", "400")
            // Class to make it responsive.
            .classed("svg-content-responsive", true)
            // Fill with a rectangle for visualization.
            .append("rect")
            .classed("rect", true)
            .attr("width", "100%")
            .attr("height", "100%");

        d3.select('svg')
            .append("circle")
            .classed("big-circle", true)
            .attr("cx", 200)
            .attr("cy", 200)
            .attr("r", 200);

        d3.select('.svg-container')
            .append("div")
            .classed("button-container", true);

        var add_circle_button = d3.select(".button-container").append("button");
        add_circle_button.text("single step");

        var start_animation_button = d3.select(".button-container").append("button");
        start_animation_button.text("start simulation");

        var stop_animation_button = d3.select(".button-container").append("button");
        stop_animation_button.text("stop simulation");

        var reset_button = d3.select(".button-container").append("button");
        reset_button.text("reset");

        var pi_value = d3.select(".button-container").append("p");
        pi_value.text("Current Estimation of pi: None yet");

        var num_steps = d3.select(".button-container").append("p");
        num_steps.text("Number of steps: None yet");



        var center = [200, 200];

        var incircle = 0;
        var outcircle = 0;

        var estimates = [];

        // line chart stuff
        var width = 400;
        var height = 400;

        var margin = { top: 50, right: 20, bottom: 50, left: 30 };

        var svgline = d3.select(".svg-container").append("svg")
            .attr("height", height).attr("width", width)
            .append("g")
            .attr("transform", "translate(" + 0 + "," + margin.right + ")");

        svgline.append("rect")
            .attr("width", 400)
            .attr("height", 400)
            .attr("fill", "white");

        var xScale = d3.scaleLinear()
            .range([0, width - margin.left - margin.right]);

        var yScale = d3.scaleLinear()
            .range([height - margin.top - margin.bottom, 0]);

        var xAxisCall = d3.axisBottom();
        var yAxisCall = d3.axisLeft();

        var plotLine = d3.line()
            .curve(d3.curveMonotoneX)
            .x(function (d) {
                return xScale(d.x);
            })
            .y(function (d) {
                return yScale(d.y);
            });

        var line = svgline.append("g").append("path").attr("transform", "translate(" + margin.left + "," + margin.top + ")")
            .datum(estimates)
            .attr("d", plotLine)
            .style("fill", "none")
            .style("stroke", "brown");

        initAxis();
        var max_estimate = -1;
        function initAxis() {
            xScale.domain([0, 1]).range([0, width - (margin.top + margin.bottom)]);
            yScale.domain([0, 1]).range([height - (margin.top + margin.bottom), 0]);
            xAxisCall.scale(xScale);
            yAxisCall.scale(yScale);

            svgline.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(" + [margin.left, height - margin.top] + ")")
                .call(xAxisCall);
            svgline.append("g")
                .attr("class", "y axis")
                .attr("transform", "translate(" + [margin.left, margin.top] + ")")
                .call(yAxisCall);
        }

        function updateAxis(count) {
            xScale.domain([0, count]).range([0, width - (margin.top + margin.bottom)]);
            xAxisCall.scale(xScale);
            yScale.domain([0, max_estimate + 0.2]).range([height - (margin.top + margin.bottom), 0]);
            yAxisCall.scale(yScale);


            var t = d3.transition()
                .duration(500);

            line.datum(estimates.map(function (item, index) { return { x: index, y: item }; }))
                .transition(t)
                .attr("d", plotLine)
                .style("fill", "none")
                .style("stroke-width", "2px")
                .style("stroke", "red");

            svgline.select(".x")
                .transition(t)
                .call(xAxisCall);

            svgline.select(".y")
                .transition(t)
                .call(yAxisCall)

        }


        var svg = d3.select('svg');


        function getRandom(min, max) {
            return Math.floor(Math.random() * (max - min) + min);
        }

        function drawCircle(x, y, size) {
            // console.log('Drawing circle at', x, y, size);
            x_adj = x - center[0];
            y_adj = center[1] - y;
            var distance = Math.sqrt(Math.pow(x_adj, 2) + Math.pow(y_adj, 2)) / center[0];
            // console.log('Distance = ', distance);
            if (distance <= 1) {
                var temp = svg.append("circle").attr('class', 'click-circle-blue').attr("cx", x).attr("cy", y);
                incircle += 1;
            }
            else {
                var temp = svg.append("circle").attr('class', 'click-circle-red').attr("cx", x).attr("cy", y);
                outcircle += 1;
            }
            temp.transition().duration(500).attr("r", 10).transition(250).attr("r", 2);
            var new_estimate = outcircle == 0 ? incircle : (incircle / outcircle);
            pi_value.text("Current Estimate of pi: " + new_estimate.toFixed(3));
            num_steps.text("Number of steps: " + (estimates.length + 1));
            estimates.push(new_estimate);
            console.log(estimates);
            //render();
            if (new_estimate > max_estimate) {
                max_estimate = new_estimate;
            }
            updateAxis(estimates.length);
        }

        function step() {
            var coords = [getRandom(0, 401), getRandom(0, 401)];
            // console.log(coords);
            drawCircle(coords[0], coords[1], 2);
        }

        function reset() {
            d3.selectAll('.click-circle-red').remove();
            d3.selectAll('.click-circle-blue').remove();
            d3.selectAll('.path').remove();

            estimates = [];
            max_estimate = -1;
            incircle = 0;
            outcircle = 0;
            updateAxis(1);

            pi_value.text("Current Estimation of pi: None yet");
            num_steps.text("Number of steps: None yet");
        }

        add_circle_button.on('click', function () {
            step();
        });

        var interval;
        start_animation_button.on('click', function () {
            interval = setInterval(step, 2);
        });

        stop_animation_button.on('click', function () {
            clearInterval(interval);
        })

        reset_button.on('click', function () {
            reset();
        })

    </script>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
</body>

</html>